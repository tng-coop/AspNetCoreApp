@using BlazorWebApp.Models
@using Microsoft.AspNetCore.Components

<ul class="nav flex-column tree-menu">
  @foreach (var item in Items)
  {
    <li class="nav-item" @key="item.Slug">
      <div class="d-flex align-items-center">

        @* Toggle button: ▶ for collapsed, ▼ for expanded *@
        @if (item.Children?.Any() == true)
        {
          <button type="button"
                  class="btn btn-sm me-2"
                  @onclick:stopPropagation
                  @onclick="() => OnChevronClick(item.Slug)">
            <span aria-hidden="true">
              @(IsExpanded(item.Slug) ? "▼" /* U+25BC */ : "▶" /* U+25B6 */)
            </span>
          </button>
        }
        else
        {
          <!-- placeholder to keep titles aligned -->
          <span class="me-2" style="width:1.25rem; display:inline-block;"></span>
        }

        <NavLink class="nav-link flex-grow-1"
                 href="@($"/{item.Slug}")"
                 Match="NavLinkMatch.Prefix">
          @if (!string.IsNullOrEmpty(item.IconCss))
          {
            <i class="bi bi-@item.IconCss me-1" aria-hidden="true"></i>
          }
          @item.Title
        </NavLink>
      </div>

      @if (item.Children?.Any() == true && IsExpanded(item.Slug))
      {
        <ul class="nav flex-column ps-4">
          <TreeMenu Items="item.Children" />
        </ul>
      }
    </li>
  }
</ul>

@code {
  [Parameter] public List<MenuItemDto> Items { get; set; } = new();
  private HashSet<string> _expanded = new();

  private void OnChevronClick(string slug) => Toggle(slug);
  private void Toggle(string slug)
  {
    if (_expanded.Contains(slug)) _expanded.Remove(slug);
    else                          _expanded.Add(slug);
  }
  private bool IsExpanded(string slug) => _expanded.Contains(slug);
}

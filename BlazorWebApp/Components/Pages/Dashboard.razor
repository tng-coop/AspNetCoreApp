@page "/dashboard"
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

<PageTitle>Dashboard</PageTitle>

@using Microsoft.AspNetCore.Identity
@using BlazorWebApp.Data
@inject UserManager<ApplicationUser> UserManager
@inject AuthenticationStateProvider AuthStateProvider

<h1>Dashboard</h1>

@if (userName is null)
{
    <p>Loadingâ€¦</p>
}
else
{
    <p>Welcome @userName (@userRole)</p>

}

@code {
    private string? userName;
    private string? userRole;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = await UserManager.GetUserAsync(authState.User);
        if (user != null)
        {
            userName = user.Email;
            var roles = await UserManager.GetRolesAsync(user);
            userRole = roles.FirstOrDefault() ?? "Member";
        }
    }
}

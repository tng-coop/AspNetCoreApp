@page "/editor"
@rendermode InteractiveServer

@using Microsoft.JSInterop
@inject IJSRuntime JS

<h3>Quill Editor</h3>
<div id="editor" style="height:200px; background:white;"></div>

<button class="btn btn-primary" @onclick="ShowPayloadSize">
  Show Payload Size
</button>

@if (payloadSize >= 0)
{
  <div class="mt-2">
    <strong>Total payload:</strong> @payloadSize bytes
  </div>
}

@code {
  private int payloadSize = -1;
  private IJSObjectReference? module;

  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    if (!firstRender) return;
    module ??= await JS.InvokeAsync<IJSObjectReference>(
      "import", "./js/quillInterop.js");
    await module.InvokeVoidAsync("initializeQuill", "#editor");
  }

  private async Task ShowPayloadSize()
  {
    payloadSize = await module!.InvokeAsync<int>("getPayloadSize");
    StateHasChanged();
  }
}

@page "/"
@page "/{Tenant}/"
@page "/_cms/{CategorySlug}"
@page "/{Tenant}/_cms/{CategorySlug}"
@page "/_cms/{CategorySlug}/{ArticleSlug}"
@page "/{Tenant}/_cms/{CategorySlug}/{ArticleSlug}"
@using BlazorWebApp.Models
@using BlazorWebApp.Services
@using BlazorWebApp.Utils
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Authorization
@inherits BlazorWebApp.Components.Shared.LocalizedComponentBase
@inject ICategoryService CategoryService
@inject IPublicationService PublicationService
@inject NavigationManager Nav

@if (pub == null)
{
    <p><em>Publication not found.</em></p>
}
else if (category == null)
{
    <h2>Category not found</h2>
}
else
{
    <h1>@PublicationUtils.LocalizedTitle(pub)</h1>

    if (primaryPost != null && pub.Slug == primaryPost.Slug)
    {
        <p class="text-muted mb-4">
            <small>Category: @fullCategoryPath</small>
        </p>
    }else{
        <p class="text-muted mb-4">
            <small>Category: @fullArticlePath</small>
        </p>
    }
    <div class="mce-content-body">
        @((MarkupString)pub.Html)
    </div>

    <p><small>Created: @pub.CreatedAt:f</small></p>

    @if (pub.PublishedAt.HasValue)
    {
        <p><small>Published: @pub.PublishedAt.Value:f</small></p>
    }

    <AuthorizeView Roles="Admin">
        <div class="mt-3">
            <button class="btn btn-secondary" @onclick="SetAsDraft">
                Set as Draft
            </button>
        </div>
    </AuthorizeView>
    if (subcats.Any())
    {
        <h4>Sub-categories</h4>
        <ul class="list-inline">
            @foreach (var sub in subcats)
            {
                <li class="list-inline-item">
                    <NavLink class="btn btn-outline-primary btn-sm" href="@CmsRoutes.Combine(sub.Slug)" Match="NavLinkMatch.Prefix">
                        @CategoryUtils.LocalizedName(sub)
                    </NavLink>
                </li>
            }
        </ul>
    }

    if (otherPosts.Any())
    {
        <h4>Other Articles in this category</h4>
        <ul class="list-unstyled">
            @foreach (var p in otherPosts)
            {
                <li class="mb-2">
                    <NavLink href="@CmsRoutes.Combine(CategorySlug, p.Slug)" Match="NavLinkMatch.Prefix">
                        <strong>@PublicationUtils.LocalizedTitle(p)</strong>
                    </NavLink>
                    <small class="text-muted ms-2">@p.PublishedAt?.ToString("g")</small>
                </li>
            }
        </ul>
    }
    <div class="mt-4">
        <NavLink href="@CmsRoutes.Combine(pub?.CategorySlug ?? string.Empty)" Match="NavLinkMatch.Prefix">
            Back to @pub?.CategoryName
        </NavLink>
    </div>
}